# Ù…Ø³ØªÙ†Ø¯ Ú©Ø§Ù…Ù„ ØªØºÛŒÛŒØ±Ø§Øª - Ø³ÛŒØ³ØªÙ… Dynamic Card Component

Ø§ÛŒÙ† Ù…Ø³ØªÙ†Ø¯ Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§ØªØŒ Ø§ÛŒØ¬Ø§Ø¯Ø§Øª Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®Ø· Ø¨Ù‡ Ø®Ø· Ø§Ø² Ø§Ø¨ØªØ¯Ø§ ØªØ§ Ø§Ù†ØªÙ‡Ø§ Ø§Ø³Øª.

---

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª](#Ø®Ù„Ø§ØµÙ‡-ØªØºÛŒÛŒØ±Ø§Øª)
2. [ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡](#ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ-Ø§ÛŒØ¬Ø§Ø¯-Ø´Ø¯Ù‡)
3. [ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡](#ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ-ØªØºÛŒÛŒØ±-ÛŒØ§ÙØªÙ‡)
4. [ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®Ø· Ø¨Ù‡ Ø®Ø·](#ØªÙˆØ¶ÛŒØ­Ø§Øª-Ø®Ø·-Ø¨Ù‡-Ø®Ø·)
5. [Ù†Ø­ÙˆÙ‡ Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ…](#Ù†Ø­ÙˆÙ‡-Ú©Ø§Ø±-Ø³ÛŒØ³ØªÙ…)

---

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª

### Ù‡Ø¯Ù Ø§ØµÙ„ÛŒ
Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Web Component Ø¨Ù‡ Ù†Ø§Ù… `cti-dynamic-card` Ú©Ù‡:
- ØªÙ…Ø§Ù… Ù…ØªÙ†â€ŒÙ‡Ø§ Ùˆ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒØ´ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø¨Ø§Ø´Ø¯
- Ø¯Ø± Ø­Ø§Ù„Øª dev ÛŒÚ© ÙØ±Ù… inspector Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± ÙØ±Ù… Ø¨Ù‡ ØµÙˆØ±Øª real-time Ø¯Ø± CDN Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆØ¯
- ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± theme-client Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ build Ø§Ø¹Ù…Ø§Ù„ Ø´ÙˆØ¯

---

## ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡

### 1. `wc-react/src/components/CTIDynamicCard.tsx`
**Ù‡Ø¯Ù**: Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª React Ø§ØµÙ„ÛŒ Ú©Ù‡ UI Ú©Ø§Ø±Øª Ø±Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯

### 2. `wc-react/src/entries/cti-dynamic-card.tsx`
**Ù‡Ø¯Ù**: Entry point Ø¨Ø±Ø§ÛŒ Web Component Ú©Ù‡ Ø´Ø§Ù…Ù„ Dev Inspector Ùˆ Ù…Ù†Ø·Ù‚ Ù…Ø¯ÛŒØ±ÛŒØª config Ø§Ø³Øª

---

## ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡

### 1. `virtual-cdn/server.js`
### 2. `wc-react/vite.config.ts`
### 3. `wc-react/src/components/index.ts`
### 4. `theme-client/src/components/ClientWrapper.tsx`
### 5. `theme-admin/app/admin/site-preview/page.tsx`
### 6. `theme-client/src/components/Info copy.tsx`

---

## ğŸ“„ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø®Ø· Ø¨Ù‡ Ø®Ø·

---

## 1ï¸âƒ£ `wc-react/src/components/CTIDynamicCard.tsx`

Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª React Ø§ØµÙ„ÛŒ Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

```typescript
import React from "react";
```

### Interface ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡:

```typescript
export interface CTIDynamicCardProps {
  title?: string;                    // Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Øª
  subtitle?: string;                 // Ø²ÛŒØ±Ø¹Ù†ÙˆØ§Ù†
  description?: string;              // ØªÙˆØ¶ÛŒØ­Ø§Øª
  primaryButtonText?: string;        // Ù…ØªÙ† Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ
  primaryButtonHref?: string;        // Ù„ÛŒÙ†Ú© Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ
  secondaryButtonText?: string;      // Ù…ØªÙ† Ø¯Ú©Ù…Ù‡ Ø«Ø§Ù†ÙˆÛŒÙ‡
  secondaryButtonHref?: string;      // Ù„ÛŒÙ†Ú© Ø¯Ú©Ù…Ù‡ Ø«Ø§Ù†ÙˆÛŒÙ‡
  imageUrl?: string;                 // Ø¢Ø¯Ø±Ø³ ØªØµÙˆÛŒØ±
  imageAlt?: string;                 // Ù…ØªÙ† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† ØªØµÙˆÛŒØ±
  badge?: string;                    // Ù…ØªÙ† badge (Ù…Ø«Ù„ "New")
  styles?: {                         // Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
    container?: React.CSSProperties;
    card?: React.CSSProperties;
    image?: React.CSSProperties;
    badge?: React.CSSProperties;
    title?: React.CSSProperties;
    subtitle?: React.CSSProperties;
    description?: React.CSSProperties;
    buttonsContainer?: React.CSSProperties;
    primaryButton?: React.CSSProperties;
    secondaryButton?: React.CSSProperties;
  };
}
```

### Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§ØµÙ„ÛŒ:

```typescript
export const CTIDynamicCard: React.FC<CTIDynamicCardProps> = ({
  title = "Dynamic Card",
  subtitle = "",
  description = "This is a fully dynamic card component...",
  // ... Ø³Ø§ÛŒØ± props Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
}) => {
```

**Ø®Ø·ÙˆØ· 23-204**: Ø³Ø§Ø®ØªØ§Ø± JSX Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
- ÛŒÚ© `<style>` tag Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡
- Ø³Ø§Ø®ØªØ§Ø± HTML Ú©Ø§Ø±Øª Ø´Ø§Ù…Ù„:
  - Badge (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯)
  - ØªØµÙˆÛŒØ± (Ø§Ú¯Ø± URL Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯)
  - Ù…Ø­ØªÙˆØ§ÛŒ Ù…ØªÙ†ÛŒ (title, subtitle, description)
  - Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ (primary Ùˆ secondary)

**Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…**: ØªÙ…Ø§Ù… Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ prop `styles` Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø¨Ù‡ ØµÙˆØ±Øª inline Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.

---

## 2ï¸âƒ£ `wc-react/src/entries/cti-dynamic-card.tsx`

Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù¾ÛŒÚ†ÛŒØ¯Ù‡â€ŒØªØ±ÛŒÙ† Ø¨Ø®Ø´ Ø§Ø³Øª Ùˆ Ø´Ø§Ù…Ù„:
1. ØªØ¹Ø±ÛŒÙ Type Config
2. ØªÙˆØ§Ø¨Ø¹ helper
3. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª DevInspector
4. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª DynamicCardWithInspector
5. Ú©Ù„Ø§Ø³ Web Component

### Ø¨Ø®Ø´ 1: Type Definition (Ø®Ø·ÙˆØ· 5-25)

```typescript
type Config = {
  title?: string;
  subtitle?: string;
  // ... ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø´Ø§Ø¨Ù‡ CTIDynamicCardProps
  styles?: {
    // ... Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§
  };
};
```

Ø§ÛŒÙ† type Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø´Ø§Ø¨Ù‡ `CTIDynamicCardProps` Ø§Ø³Øª Ùˆ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª config Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

### Ø¨Ø®Ø´ 2: Helper Functions

#### `isInspectorEnabled` (Ø®Ø·ÙˆØ· 18-28)

```typescript
function isInspectorEnabled(hostEl: HTMLElement) {
  // 1) Ø¨Ø±Ø±Ø³ÛŒ attribute Ø±ÙˆÛŒ element
  const attr = hostEl.getAttribute("data-inspector");
  if (attr === "1" || attr === "true") return true;

  // 2) Ø¨Ø±Ø±Ø³ÛŒ global flag
  const g: any = globalThis as any;
  if (g && g.__CTI_WC_DEV__ === true) return true;

  return false;
}
```

**Ù‡Ø¯Ù**: Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¢ÛŒØ§ inspector Ø¨Ø§ÛŒØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ ÛŒØ§ Ù†Ù‡.

**Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ**:
1. `data-inspector="1"` Ø±ÙˆÛŒ element
2. `window.__CTI_WC_DEV__ = true` Ø¯Ø± global scope

#### `safeParseConfig` (Ø®Ø·ÙˆØ· 30-38)

```typescript
function safeParseConfig(raw: string | null): Config {
  if (!raw) return {};
  try {
    const parsed = JSON.parse(raw);
    return parsed && typeof parsed === "object" ? parsed : {};
  } catch {
    return {};
  }
}
```

**Ù‡Ø¯Ù**: Ù¾Ø§Ø±Ø³ Ú©Ø±Ø¯Ù† JSON Ø§Ø² attribute `data-config` Ø¨Ù‡ ØµÙˆØ±Øª Ø§Ù…Ù†.

**Ù…Ø²Ø§ÛŒØ§**:
- Ø§Ú¯Ø± JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ØŒ object Ø®Ø§Ù„ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
- Ø§Ø² crash Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### `safeStringifyConfig` (Ø®Ø·ÙˆØ· 40-46)

```typescript
function safeStringifyConfig(cfg: Config) {
  try {
    return JSON.stringify(cfg);
  } catch {
    return "{}";
  }
}
```

**Ù‡Ø¯Ù**: ØªØ¨Ø¯ÛŒÙ„ Config object Ø¨Ù‡ JSON string Ø¨Ù‡ ØµÙˆØ±Øª Ø§Ù…Ù†.

### Ø¨Ø®Ø´ 3: DevInspector Component (Ø®Ø·ÙˆØ· 48-499)

Ø§ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª ÙØ±Ù… dev Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

#### State Management (Ø®Ø·ÙˆØ· 55-58)

```typescript
const inspectorRef = useRef<HTMLDivElement>(null);
const [pos, setPos] = useState({ x: 10, y: 10 });
const [dragging, setDragging] = useState(false);
const dragOffset = useRef({ x: 0, y: 0 });
```

**Ù‡Ø¯Ù**: Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ùˆ drag & drop ÙØ±Ù….

#### Drag & Drop Logic (Ø®Ø·ÙˆØ· 60-86)

```typescript
const onDragMouseDown = (e: React.MouseEvent) => {
  e.stopPropagation();
  setDragging(true);
  const rect = inspectorRef.current!.getBoundingClientRect();
  dragOffset.current = { x: e.clientX - rect.left, y: e.clientY - rect.top };
  e.preventDefault();
};
```

**Ù‡Ø¯Ù**: Ø´Ø±ÙˆØ¹ drag operation.

```typescript
const onMouseMove = (e: MouseEvent) => {
  if (!dragging) return;
  setPos({
    x: e.clientX - dragOffset.current.x,
    y: e.clientY - dragOffset.current.y,
  });
};
```

**Ù‡Ø¯Ù**: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±Ù… Ù‡Ù†Ú¯Ø§Ù… drag.

#### JSX Structure (Ø®Ø·ÙˆØ· 88-499)

**Ø®Ø·ÙˆØ· 88-127**: Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CSS Ø¨Ø±Ø§ÛŒ ÙØ±Ù… inspector

**Ø®Ø·ÙˆØ· 129-143**: Header ÙØ±Ù… Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Drag

**Ø®Ø·ÙˆØ· 145-308**: Ø¨Ø®Ø´ Content
- Title input
- Subtitle input
- Description textarea
- Badge Ùˆ Image URL (Ø¯Ø± ÛŒÚ© row2)
- Image Alt Text

**Ø®Ø·ÙˆØ· 310-383**: Ø¨Ø®Ø´ Buttons
- Primary Button Text Ùˆ Href
- Secondary Button Text Ùˆ Href

**Ø®Ø·ÙˆØ· 385-473**: Ø¨Ø®Ø´ Styles
- Card Background
- Title Color
- Subtitle Color
- Description Color
- Primary Button Background Ùˆ Text Color
- Secondary Button Background Ùˆ Text Color

**Ø®Ø·ÙˆØ· 475-499**: Ø¯Ú©Ù…Ù‡ Reset Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶

#### Helper Function: `updateStyle` (Ø®Ø·ÙˆØ· 185-197)

```typescript
const updateStyle = (
  section: keyof NonNullable<Config["styles"]>,
  property: string,
  val: string
) => {
  onChange({
    ...value,
    styles: {
      ...value.styles,
      [section]: {
        ...value.styles?.[section],
        [property]: val,
      },
    },
  });
};
```

**Ù‡Ø¯Ù**: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÛŒÚ© property Ø®Ø§Øµ Ø¯Ø± styles object.

### Ø¨Ø®Ø´ 4: DynamicCardWithInspector Component (Ø®Ø·ÙˆØ· 501-630)

Ø§ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª wrapper Ø§ØµÙ„ÛŒ Ø§Ø³Øª Ú©Ù‡:
1. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ú©Ø§Ø±Øª Ø±Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
2. Dev Inspector Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
3. ØªØºÛŒÛŒØ±Ø§Øª config Ø±Ø§ Ø¨Ù‡ CDN Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### State Management (Ø®Ø·ÙˆØ· 508-516)

```typescript
const [config, setConfig] = useState<Config>(initialConfig);
const configRef = useRef<Config>(initialConfig);

// Keep ref in sync with state
useEffect(() => {
  configRef.current = config;
}, [config]);
```

**Ù‡Ø¯Ù**: 
- `config`: state Ø§ØµÙ„ÛŒ
- `configRef`: ref Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± event listeners (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² stale closure)

#### External Config Change Listener (Ø®Ø·ÙˆØ· 510-548)

```typescript
useEffect(() => {
  const handleConfigChange = (e: CustomEvent) => {
    if (e.detail && typeof e.detail === "object") {
      const newConfig = e.detail as Config;
      const currentConfigStr = JSON.stringify(configRef.current);
      const newConfigStr = JSON.stringify(newConfig);
      if (currentConfigStr !== newConfigStr) {
        setConfig(newConfig);
      }
    }
  };

  const handleAttributeChange = () => {
    const newConfig = safeParseConfig(hostEl.getAttribute("data-config"));
    const currentConfigStr = JSON.stringify(configRef.current);
    const newConfigStr = JSON.stringify(newConfig);
    if (currentConfigStr !== newConfigStr) {
      setConfig(newConfig);
    }
  };

  hostEl.addEventListener("cti:config-change", handleConfigChange as EventListener);
  
  const observer = new MutationObserver(() => {
    handleAttributeChange();
  });

  observer.observe(hostEl, {
    attributes: true,
    attributeFilter: ["data-config"],
  });

  return () => {
    hostEl.removeEventListener("cti:config-change", handleConfigChange as EventListener);
    observer.disconnect();
  };
}, [hostEl]);
```

**Ù‡Ø¯Ù**: Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª Ø®Ø§Ø±Ø¬ÛŒ config

**Ø¯Ùˆ Ø±ÙˆØ´**:
1. **Custom Event**: `cti:config-change` event
2. **MutationObserver**: ØªØºÛŒÛŒØ±Ø§Øª attribute `data-config`

**Ú†Ø±Ø§ configRef Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯ØŸ**
- Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² dependency Ø¯Ø± useEffect
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² infinite loop
- Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± config Ø¯Ø± event handlers

#### Computed Values (Ø®Ø·ÙˆØ· 550-565)

```typescript
const computed = useMemo(() => {
  return {
    title: config.title ?? "Dynamic Card",
    subtitle: config.subtitle ?? "",
    // ... Ø³Ø§ÛŒØ± ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
  };
}, [config]);
```

**Ù‡Ø¯Ù**: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ fallback Ø¨Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶.

#### Inspector Flag Detection (Ø®Ø·ÙˆØ· 567-586)

```typescript
const [showInspectorFlag, setShowInspectorFlag] = useState(() =>
  isInspectorEnabled(hostEl)
);

useEffect(() => {
  if (showInspectorFlag) return;

  let tries = 0;
  const id = window.setInterval(() => {
    tries += 1;
    if (isInspectorEnabled(hostEl)) {
      setShowInspectorFlag(true);
      window.clearInterval(id);
    } else if (tries >= 20) {
      window.clearInterval(id);
    }
  }, 250);

  return () => window.clearInterval(id);
}, [showInspectorFlag, hostEl]);
```

**Ù‡Ø¯Ù**: Ø¨Ø±Ø±Ø³ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ (polling) Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯Ù† inspector.

**Ù…Ù†Ø·Ù‚**:
- Ø§Ú¯Ø± Ø§Ø² Ø§Ø¨ØªØ¯Ø§ ÙØ¹Ø§Ù„ Ù†Ø¨ÙˆØ¯ØŒ Ù‡Ø± 250ms Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ø¨Ø§Ø± ØªÙ„Ø§Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (5 Ø«Ø§Ù†ÛŒÙ‡)
- Ø§Ú¯Ø± ÙØ¹Ø§Ù„ Ø´Ø¯ØŒ polling Ù…ØªÙˆÙ‚Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯

#### Inspector Open State (Ø®Ø·ÙˆØ· 588-593)

```typescript
const [inspectorOpen, setInspectorOpen] = useState(false);

useEffect(() => {
  if (showInspectorFlag) setInspectorOpen(true);
}, [showInspectorFlag]);
```

**Ù‡Ø¯Ù**: Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± inspector ÙˆÙ‚ØªÛŒ flag ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

#### Update Config Function (Ø®Ø·ÙˆØ· 595-630)

```typescript
const updateConfig = async (next: Config) => {
  setConfig(next);

  if (showInspectorFlag) {
    hostEl.setAttribute("data-config", safeStringifyConfig(next));
    hostEl.dispatchEvent(
      new CustomEvent("cti:config-change", { detail: next, bubbles: true })
    );

    // Ø§Ø±Ø³Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ù‡ CDN
    try {
      const cdnUrl =
        (globalThis as any).__CTI_CDN_URL__ || "http://localhost:4000";
      const componentId = hostEl.tagName.toLowerCase();

      await fetch(`${cdnUrl}/config/components/${componentId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ config: next }),
      });

      // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ parent window (Ø¨Ø±Ø§ÛŒ site-preview)
      if (window.parent && window.parent !== window) {
        window.parent.postMessage(
          {
            type: "configChanged",
            payload: { componentId, config: next },
          },
          "*"
        );
      }
    } catch (err) {
      console.warn("Failed to save config to CDN:", err);
    }
  }
};
```

**Ù‡Ø¯Ù**: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ config Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ CDN

**Ù…Ø±Ø§Ø­Ù„**:
1. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ state
2. Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ attribute `data-config`
3. Ø§Ø±Ø³Ø§Ù„ custom event
4. Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ CDN (POST request)
5. Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ parent window (Ø§Ú¯Ø± Ø¯Ø± iframe Ø¨Ø§Ø´Ø¯)

#### Render (Ø®Ø·ÙˆØ· 632-660)

```typescript
return (
  <div className="cti-dynamic-card-host">
    <style>{/* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ host */}</style>
    <CTIDynamicCard {...computed} styles={config.styles} />
    {showInspectorFlag && (
      <>
        <button onClick={() => setInspectorOpen((v) => !v)}>
          {inspectorOpen ? "Close Inspector" : "Open Inspector"}
        </button>
        {inspectorOpen && (
          <DevInspector value={config} onChange={updateConfig} />
        )}
      </>
    )}
  </div>
);
```

**Ù‡Ø¯Ù**: Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Øª Ùˆ inspector

### Ø¨Ø®Ø´ 5: Web Component Class (Ø®Ø·ÙˆØ· 662-721)

```typescript
class CTIDynamicCardElement extends HTMLElement {
  private root: ReturnType<typeof createRoot> | null = null;

  static get observedAttributes() {
    return ["data-config"];
  }

  connectedCallback() {
    const container = document.createElement("div");
    this.appendChild(container);

    const initialConfig = safeParseConfig(this.getAttribute("data-config"));

    const root = createRoot(container);
    this.root = root;

    root.render(
      <DynamicCardWithInspector hostEl={this} initialConfig={initialConfig} />
    );
  }

  disconnectedCallback() {
    this.root?.unmount();
  }

  attributeChangedCallback(name: string, _oldValue: string, newValue: string) {
    if (name === "data-config" && this.root) {
      const newConfig = safeParseConfig(newValue);
      this.root.render(
        <DynamicCardWithInspector hostEl={this} initialConfig={newConfig} />
      );
    }
  }
}

customElements.define("cti-dynamic-card", CTIDynamicCardElement);
```

**ØªÙˆØ¶ÛŒØ­Ø§Øª**:

1. **observedAttributes**: Ù„ÛŒØ³Øª attributeÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ watch Ø´ÙˆÙ†Ø¯
2. **connectedCallback**: ÙˆÙ‚ØªÛŒ element Ø¨Ù‡ DOM Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - ÛŒÚ© container div Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯
   - config Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯
   - React root Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯ Ùˆ render Ù…ÛŒâ€ŒÚ©Ù†Ø¯
3. **disconnectedCallback**: ÙˆÙ‚ØªÛŒ element Ø§Ø² DOM Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - React root Ø±Ø§ unmount Ù…ÛŒâ€ŒÚ©Ù†Ø¯
4. **attributeChangedCallback**: ÙˆÙ‚ØªÛŒ `data-config` ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - config Ø¬Ø¯ÛŒØ¯ Ø±Ø§ parse Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - Ø¯ÙˆØ¨Ø§Ø±Ù‡ render Ù…ÛŒâ€ŒÚ©Ù†Ø¯

---

## 3ï¸âƒ£ `virtual-cdn/server.js`

### ØªØºÛŒÛŒØ±Ø§Øª: Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Endpoints Ø¨Ø±Ø§ÛŒ Config

#### GET `/config/components/:id` (Ø®Ø·ÙˆØ· 398-410)

```javascript
app.get("/config/components/:id", async (req, res) => {
  const id = req.params.id;
  const file = path.join(CACHE_DIR, `config_components_${id}.json`);

  res.setHeader("Content-Type", "application/json");
  res.setHeader("Cache-Control", "no-store");
  res.setHeader("Access-Control-Allow-Origin", "*");

  try {
    const content = await fs.readFile(file, "utf-8");
    return res.send(content);
  } catch {
    // Ø§Ú¯Ø± config Ù†ÛŒØ³ØªØŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†
    return res.json({ config: {} });
  }
});
```

**Ù‡Ø¯Ù**: Ø®ÙˆØ§Ù†Ø¯Ù† config ÛŒÚ© Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§Ø² cache

**Ù…Ù†Ø·Ù‚**:
- ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø² cache Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯
- Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ object Ø®Ø§Ù„ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
- Cache-Control: no-store Ø¨Ø±Ø§ÛŒ real-time updates

#### POST `/config/components/:id` (Ø®Ø·ÙˆØ· 412-427)

```javascript
app.post("/config/components/:id", async (req, res) => {
  const id = req.params.id;
  const file = path.join(CACHE_DIR, `config_components_${id}.json`);

  res.setHeader("Content-Type", "application/json");
  res.setHeader("Cache-Control", "no-store");
  res.setHeader("Access-Control-Allow-Origin", "*");

  try {
    // body: { config: { title: "...", description: "..." } }
    await ensureCache();
    await fs.writeFile(file, JSON.stringify(req.body || {}, null, 2), "utf-8");

    console.log(`âœ… Config saved for component: ${id}`);
    return res.json({ ok: true });
  } catch (err) {
    console.error("âŒ Config write failed:", err.message);
    return res.status(500).json({ ok: false, error: err.message });
  }
});
```

**Ù‡Ø¯Ù**: Ø°Ø®ÛŒØ±Ù‡ config ÛŒÚ© Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø¯Ø± cache

**Ù…Ù†Ø·Ù‚**:
- body Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª JSON Ø¯Ø± ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„: `cache/config_components_{id}.json`
- Ø®Ø·Ø§Ù‡Ø§ Ø±Ø§ handle Ù…ÛŒâ€ŒÚ©Ù†Ø¯

---

## 4ï¸âƒ£ `wc-react/vite.config.ts`

### ØªØºÛŒÛŒØ±Ø§Øª: Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Entry Point

```typescript
entry: {
  "cti-dynamic-card": resolve(__dirname, "src/entries/cti-dynamic-card.tsx"),
},
```

**Ù‡Ø¯Ù**: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† entry point Ø¨Ø±Ø§ÛŒ build

**Ù†ØªÛŒØ¬Ù‡**: Ø¨Ø¹Ø¯ Ø§Ø² buildØŒ ÙØ§ÛŒÙ„ `cti-dynamic-card.js` Ø¯Ø± `virtual-cdn/public/wc/` Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯

---

## 5ï¸âƒ£ `wc-react/src/components/index.ts`

### ØªØºÛŒÛŒØ±Ø§Øª: Export Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª

```typescript
export { CTIDynamicCard } from "./CTIDynamicCard";
export type { CTIDynamicCardProps } from "./CTIDynamicCard";
```

**Ù‡Ø¯Ù**: Ø§Ù…Ú©Ø§Ù† import Ø§Ø² index

---

## 6ï¸âƒ£ `theme-client/src/components/ClientWrapper.tsx`

### ØªØºÛŒÛŒØ±Ø§Øª: Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Message Handler Ø¨Ø±Ø§ÛŒ setConfig

```typescript
if (data.type === "setConfig") {
  const config = data.payload?.config ?? data.payload;
  const targets = resolveTargets(data.payload?.componentId);
  if (targets.length === 0 || !config) return;

  targets.forEach((target) => {
    target.setAttribute("data-config", JSON.stringify(config));
    // Trigger custom event to notify component
    target.dispatchEvent(
      new CustomEvent("cti:config-change", {
        detail: config,
        bubbles: true,
      })
    );
  });
}
```

**Ù‡Ø¯Ù**: Ø¯Ø±ÛŒØ§ÙØª config Ø§Ø² site-preview Ùˆ Ø§Ø¹Ù…Ø§Ù„ Ø±ÙˆÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª

**Ù…Ù†Ø·Ù‚**:
1. ØªÙ…Ø§Ù… Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ÛŒ matching Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
2. attribute `data-config` Ø±Ø§ set Ù…ÛŒâ€ŒÚ©Ù†Ø¯
3. custom event `cti:config-change` Ø±Ø§ trigger Ù…ÛŒâ€ŒÚ©Ù†Ø¯
4. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Web Component Ø§ÛŒÙ† event Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù†ÙˆØ¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯

---

## 7ï¸âƒ£ `theme-admin/app/admin/site-preview/page.tsx`

### ØªØºÛŒÛŒØ±Ø§Øª: Ù…Ø¯ÛŒØ±ÛŒØª Config Ø¯Ø± Site Preview

#### State Ø¬Ø¯ÛŒØ¯ (Ø®Ø· 45)

```typescript
const [componentConfig, setComponentConfig] = useState<Record<string, any>>({});
```

**Ù‡Ø¯Ù**: Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ config Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡

#### Load Config on Component Selection (Ø®Ø·ÙˆØ· 57-71)

```typescript
// Load config from CDN
const loadConfig = async () => {
  try {
    const cdnUrl = process.env.NEXT_PUBLIC_CDN_URL || "http://localhost:4000";
    const res = await fetch(`${cdnUrl}/config/components/${nextId}`, {
      cache: "no-store",
    });
    const data = await res.json();
    setComponentConfig(data?.config || {});
  } catch (err) {
    console.error("Failed to load config:", err);
    setComponentConfig({});
  }
};
loadConfig();
```

**Ù‡Ø¯Ù**: ÙˆÙ‚ØªÛŒ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†ØªÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ config Ø¢Ù† Ø±Ø§ Ø§Ø² CDN Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯

#### Send Config to Iframe (Ø®Ø·ÙˆØ· 137-150)

```typescript
// Send config to iframe when it changes
useEffect(() => {
  if (!iframeLoaded || !selectedComponentId || Object.keys(componentConfig).length === 0) return;
  const targetWindow = iframeRef.current?.contentWindow;
  if (!targetWindow) return;
  targetWindow.postMessage(
    {
      type: "setConfig",
      payload: { componentId: selectedComponentId, config: componentConfig },
    },
    clientOrigin
  );
}, [componentConfig, iframeLoaded, selectedComponentId, clientOrigin]);
```

**Ù‡Ø¯Ù**: Ø§Ø±Ø³Ø§Ù„ config Ø¨Ù‡ iframe ÙˆÙ‚ØªÛŒ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯

**Ù…Ù†Ø·Ù‚**:
- Ù…Ù†ØªØ¸Ø± Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ ØªØ§ iframe load Ø´ÙˆØ¯
- Ù…Ù†ØªØ¸Ø± Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ ØªØ§ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†ØªÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯
- Ù…Ù†ØªØ¸Ø± Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ ØªØ§ config Ø®Ø§Ù„ÛŒ Ù†Ø¨Ø§Ø´Ø¯
- Ù¾ÛŒØ§Ù… `setConfig` Ø±Ø§ Ø¨Ù‡ iframe Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### Listen for Config Changes from Iframe (Ø®Ø·ÙˆØ· 152-170)

```typescript
// Listen for config changes from iframe (from dev inspector)
useEffect(() => {
  if (!iframeLoaded) return;
  
  const handleConfigChange = (event: MessageEvent) => {
    if (event.origin !== clientOrigin) return;
    const data = event.data || {};
    if (data.type === "configChanged") {
      const { componentId, config } = data.payload || {};
      if (componentId === selectedComponentId && config) {
        setComponentConfig(config);
      }
    }
  };
  
  window.addEventListener("message", handleConfigChange);
  return () => window.removeEventListener("message", handleConfigChange);
}, [iframeLoaded, selectedComponentId, clientOrigin]);
```

**Ù‡Ø¯Ù**: Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª config Ø§Ø² iframe

**Ù…Ù†Ø·Ù‚**:
- ÙˆÙ‚ØªÛŒ dev inspector Ø¯Ø± iframe config Ø±Ø§ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- Ù¾ÛŒØ§Ù… `configChanged` Ø¨Ù‡ parent Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- Ø§ÛŒÙ† handler Ø¢Ù† Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ state Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- Ø§ÛŒÙ† Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ useEffect Ù‚Ø¨Ù„ÛŒ trigger Ø´ÙˆØ¯ Ùˆ config Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ iframe Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯

---

## 8ï¸âƒ£ `theme-client/src/components/Info copy.tsx`

### ØªØºÛŒÛŒØ±Ø§Øª: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Polling Config Ø§Ø² CDN

#### Load Bundle (Ø®Ø·ÙˆØ· 23-52)

```typescript
useEffect(() => {
  let cancelled = false;

  async function loadBundle() {
    try {
      const bundle = `${
        process.env.NEXT_PUBLIC_CDN_URL || "http://localhost:4000"
      }/wc/cti-dynamic-card.js`;
      if (bundle) {
        if (!cancelled) loadOnce(bundle);
        return;
      }
      // ... fallback
    } catch {
      // ... fallback
    }
  }

  loadBundle();
  return () => {
    cancelled = true;
  };
}, []);
```

**Ù‡Ø¯Ù**: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ bundle Web Component Ø§Ø² CDN

**Ù…Ù†Ø·Ù‚**:
- ÛŒÚ© script tag Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø¨Ù‡ DOM Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- Ø§Ø² duplicate loading Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### Load and Poll Config (Ø®Ø·ÙˆØ· 54-105)

```typescript
// Load config from CDN and poll for changes
useEffect(() => {
  if (!ref.current) return;

  let lastConfigHash = "";

  const loadConfig = async () => {
    try {
      const cdnUrl =
        process.env.NEXT_PUBLIC_CDN_URL || "http://localhost:4000";
      const res = await fetch(
        `${cdnUrl}/config/components/cti-dynamic-card`,
        {
          cache: "no-store",
        }
      );
      const data = await res.json();
      const config = data?.config || {};

      const configStr = JSON.stringify(config);
      const configHash = configStr;

      // Only update if config actually changed
      if (configHash !== lastConfigHash && ref.current) {
        lastConfigHash = configHash;
        if (Object.keys(config).length > 0) {
          ref.current.setAttribute("data-config", configStr);
          // Trigger config change event
          ref.current.dispatchEvent(
            new CustomEvent("cti:config-change", {
              detail: config,
              bubbles: true,
            })
          );
        }
      }
    } catch (err) {
      console.warn("Failed to load config from CDN:", err);
    }
  };

  // Initial load
  const timeout = setTimeout(loadConfig, 100);

  // Poll for changes every 2 seconds (only in dev/admin preview mode)
  const isDev =
    process.env.NODE_ENV === "development" ||
    (typeof window !== "undefined" &&
      new URL(window.location.href).searchParams.get("adminPreview") === "1");

  let pollInterval: NodeJS.Timeout | null = null;
  if (isDev) {
    pollInterval = setInterval(loadConfig, 2000);
  }

  return () => {
    clearTimeout(timeout);
    if (pollInterval) clearInterval(pollInterval);
  };
}, []);
```

**Ù‡Ø¯Ù**: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ polling Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ±Ø§Øª config

**Ù…Ù†Ø·Ù‚**:

1. **Initial Load**: Ø¨Ø¹Ø¯ Ø§Ø² 100ms config Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯ (Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² mount Ø´Ø¯Ù† element)

2. **Polling**: 
   - ÙÙ‚Ø· Ø¯Ø± dev mode ÛŒØ§ admin preview
   - Ù‡Ø± 2 Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ© Ø¨Ø§Ø± config Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯
   - Ø¨Ø§ hash Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ØªØ§ ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†Ø¯

3. **Update**:
   - attribute `data-config` Ø±Ø§ set Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - custom event `cti:config-change` Ø±Ø§ trigger Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - Web Component Ø§ÛŒÙ† event Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù†ÙˆØ¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯

**Ú†Ø±Ø§ PollingØŸ**
- Ø¨Ø±Ø§ÛŒ real-time updates Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ WebSocket
- ÙÙ‚Ø· Ø¯Ø± dev mode ÙØ¹Ø§Ù„ Ø§Ø³Øª (performance)
- Ø¨Ø§ hash comparison Ø§Ø² unnecessary updates Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### Render (Ø®Ø·ÙˆØ· 107-115)

```typescript
const element = `cti-dynamic-card`;

const isDev = process.env.NODE_ENV === "development";
const isAdminPreview =
  typeof window !== "undefined" &&
  new URL(window.location.href).searchParams.get("adminPreview") === "1";

return React.createElement(element, {
  ref,
  ...(isDev || isAdminPreview ? { "data-inspector": "1" } : {}),
});
```

**Ù‡Ø¯Ù**: Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Web Component

**Ù…Ù†Ø·Ù‚**:
- Ø¯Ø± dev mode ÛŒØ§ admin previewØŒ `data-inspector="1"` Ø±Ø§ set Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- Ø§ÛŒÙ† Ø¨Ø§Ø¹Ø« ÙØ¹Ø§Ù„ Ø´Ø¯Ù† Dev Inspector Ù…ÛŒâ€ŒØ´ÙˆØ¯

---

## ğŸ”„ Ù†Ø­ÙˆÙ‡ Ú©Ø§Ø± Ø³ÛŒØ³ØªÙ… (Flow)

### Ø³Ù†Ø§Ø±ÛŒÙˆ 1: ØªØºÛŒÛŒØ± Ø¯Ø± Dev Inspector

```
1. Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± /admin/site-preview Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
2. Dev Inspector Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
3. Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ÙØ±Ù… ØªØºÛŒÛŒØ±Ø§ØªÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
4. updateConfig() ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
5. Config Ø¨Ù‡ CDN Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (POST /config/components/cti-dynamic-card)
   â†“
6. Ù¾ÛŒØ§Ù… configChanged Ø¨Ù‡ parent window Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
7. site-preview Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ state Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
8. useEffect trigger Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ config Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ iframe Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
9. ClientWrapper Ù¾ÛŒØ§Ù… setConfig Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
10. attribute data-config Ø±Ø§ set Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ event trigger Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
11. Web Component event Ø±Ø§ Ù…ÛŒâ€ŒØ´Ù†ÙˆØ¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯
```

### Ø³Ù†Ø§Ø±ÛŒÙˆ 2: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Theme Client

```
1. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª DinamicCard mount Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
2. Bundle Ø§Ø² CDN Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
3. Ø¨Ø¹Ø¯ Ø§Ø² 100ms config Ø§Ø² CDN Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
4. attribute data-config set Ù…ÛŒâ€ŒØ´ÙˆØ¯
   â†“
5. Web Component config Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯ Ùˆ render Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
6. Polling Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù‡Ø± 2 Ø«Ø§Ù†ÛŒÙ‡)
   â†“
7. Ø§Ú¯Ø± config ØªØºÛŒÛŒØ± Ú©Ø±Ø¯:
   - attribute Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - event trigger Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Web Component Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯
```

### Ø³Ù†Ø§Ø±ÛŒÙˆ 3: ØªØºÛŒÛŒØ± Ø§Ø² Admin Panel

```
1. Admin config Ø±Ø§ Ø¯Ø± CDN Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
2. Theme Client polling Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ù‡Ø± 2 Ø«Ø§Ù†ÛŒÙ‡)
   â†“
3. ØªØºÛŒÛŒØ± Ø±Ø§ detect Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   â†“
4. Config Ø±Ø§ Ø§Ø¹Ù…Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
```

---

## ğŸ¯ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

### 1. Ú†Ø±Ø§ Ø§Ø² useRef Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯ØŸ
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² stale closure Ø¯Ø± event listeners
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² infinite loop Ø¯Ø± useEffect

### 2. Ú†Ø±Ø§ PollingØŸ
- Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø§Ø² WebSocket
- ÙÙ‚Ø· Ø¯Ø± dev mode ÙØ¹Ø§Ù„ Ø§Ø³Øª
- Ø¨Ø§ hash comparison Ø¨Ù‡ÛŒÙ†Ù‡ Ø´Ø¯Ù‡

### 3. Ú†Ø±Ø§ MutationObserverØŸ
- Ø¨Ø±Ø§ÛŒ detect Ú©Ø±Ø¯Ù† ØªØºÛŒÛŒØ±Ø§Øª attribute Ø§Ø² Ø®Ø§Ø±Ø¬
- Real-time updates Ø¨Ø¯ÙˆÙ† polling

### 4. Ú†Ø±Ø§ Custom EventsØŸ
- Decoupling Ø¨ÛŒÙ† Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§
- Ø§Ù…Ú©Ø§Ù† listen Ú©Ø±Ø¯Ù† Ø§Ø² Ù‡Ø± Ø¬Ø§ÛŒÛŒ

### 5. Ú†Ø±Ø§ Cache-Control: no-storeØŸ
- Ø¨Ø±Ø§ÛŒ real-time updates
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² cache Ø´Ø¯Ù† config

---

## ğŸ“Š Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

```
wc-react/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ CTIDynamicCard.tsx          (Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª React)
â”‚   â”‚   â””â”€â”€ index.ts                    (exports)
â”‚   â””â”€â”€ entries/
â”‚       â””â”€â”€ cti-dynamic-card.tsx         (Web Component + Inspector)
â”œâ”€â”€ vite.config.ts                      (build config)
â””â”€â”€ package.json

virtual-cdn/
â”œâ”€â”€ server.js                           (CDN server + endpoints)
â””â”€â”€ cache/
    â””â”€â”€ config_components_*.json        (Ø°Ø®ÛŒØ±Ù‡ config Ù‡Ø§)

theme-admin/
â””â”€â”€ app/
    â””â”€â”€ admin/
        â””â”€â”€ site-preview/
            â””â”€â”€ page.tsx                (Ù…Ø¯ÛŒØ±ÛŒØª config Ø¯Ø± admin)

theme-client/
â””â”€â”€ src/
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ ClientWrapper.tsx           (message handlers)
    â”‚   â””â”€â”€ Info copy.tsx               (DinamicCard component)
    â””â”€â”€ app/
        â””â”€â”€ page.tsx                    (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² DinamicCard)
```

---

## âœ… Ø®Ù„Ø§ØµÙ‡

1. **Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª React** Ø¨Ø±Ø§ÛŒ UI
2. **Web Component** Ø¨Ø±Ø§ÛŒ encapsulation
3. **Dev Inspector** Ø¨Ø±Ø§ÛŒ editing Ø¯Ø± dev mode
4. **CDN Endpoints** Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡/Ø®ÙˆØ§Ù†Ø¯Ù† config
5. **Message Passing** Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨ÛŒÙ† admin Ùˆ client
6. **Polling** Ø¨Ø±Ø§ÛŒ real-time updates
7. **Event System** Ø¨Ø±Ø§ÛŒ reactivity

ØªÙ…Ø§Ù… Ø§ÛŒÙ†â€ŒÙ‡Ø§ Ø¨Ø§ Ù‡Ù… ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ Ú©Ù‡ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ build Ù…Ø¬Ø¯Ø¯ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

